---
# Core node patch - for control plane nodes
# These nodes are always-on and host critical services
# Hardware: Fujitsu Esprimo (64GB RAM, i5-7400T)

machine:
  kubelet:
    extraArgs:
      rotate-certificates: true
    nodeIP:
      validSubnets:
        - 10.10.0.0/24  # Cluster network
    nodeLabels:
      node-role: core
      availability: always-on
      storage: longhorn

  network:
    nameservers:
      - 10.10.0.1  # OPNsense with split DNS

  time:
    servers:
      - 10.10.0.1
      - time.google.com

  sysctls:
    # Kernel tuning for Longhorn
    vm.max_map_count: "262144"
    fs.inotify.max_user_watches: "524288"
    fs.inotify.max_user_instances: "512"

cluster:
  allowSchedulingOnControlPlanes: true  # Allowed as per tasks.md

  network:
    cni:
      name: none  # Installed via Fleet (Cilium)
